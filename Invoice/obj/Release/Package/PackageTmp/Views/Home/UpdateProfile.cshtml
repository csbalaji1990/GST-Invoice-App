@model Invoice.Models.DbCompany

@{
    ViewBag.Title = "Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section title {
    Company Settings
}

@section card_body {
    <ul class="nav nav-tabs profile-tab" role="tablist">
        <li class="nav-item"> <a class="nav-link active" data-toggle="tab" href="#companyInfo" role="tab">Company Info</a> </li>
        <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#bankAccountInfo" role="tab">Bank Account Info</a> </li>
        <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#emailSetting" role="tab">Email Settings</a> </li>
        <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#password" role="tab">Change PIN</a> </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="companyInfo" role="tabpanel">
            <div class="card-body">
                <form id="formCompanyInfo">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Business Name</label>
                                @Html.TextBoxFor(m => m.CompanyName, new { @maxlength = "100", @required = "required", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Email</label>
                                @Html.TextBoxFor(m => m.Email, new { @maxlength = "100", @type = "email", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Website</label>
                                @Html.TextBoxFor(m => m.Website, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>GSTIN</label>
                                @Html.TextBoxFor(m => m.Gstin, new { @maxlength = "15", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>PAN No</label>
                                @Html.TextBoxFor(m => m.Pan, new { @maxlength = "10", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Mobile</label>
                                @Html.TextBoxFor(m => m.Mobile, new { @maxlength = "10", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Landline</label>
                                @Html.TextBoxFor(m => m.Landline, new { @maxlength = "12", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Address</label>
                                @Html.TextBoxFor(m => m.Address, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Pincode</label>
                                @Html.TextBoxFor(m => m.Pincode, new { @maxlength = "6", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>City</label>
                                @Html.TextBoxFor(m => m.City, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>State</label>
                                @Html.DropDownListFor(m => m.State, (SelectList)ViewBag.StateList, new { @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="btnSaveCompanyInfo" class="btn btn-info waves-effect waves-light float-right">Save</button>
                </form>
            </div>
        </div>
        <div class="tab-pane" id="bankAccountInfo" role="tabpanel">
            <div class="card-body">
                <form id="formBankAccountInfo">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Account No</label>
                                @Html.TextBoxFor(m => m.AccountNo, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Account Name</label>
                                @Html.TextBoxFor(m => m.AccountName, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Account Type</label>
                                @Html.TextBoxFor(m => m.AccountType, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Bank Name</label>
                                @Html.TextBoxFor(m => m.BankName, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>IFSC Code</label>
                                @Html.TextBoxFor(m => m.Ifsc, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Branch</label>
                                @Html.TextBoxFor(m => m.Branch, new { @maxlength = "100", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="btnSaveBankAccountInfo" class="btn btn-info waves-effect waves-light float-right">Save</button>
                </form>
            </div>
        </div>
        <div class="tab-pane" id="emailSetting" role="tabpanel">
            <div class="card-body">
                <form id="formEmailSetting">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>SMTP Host</label>
                                @Html.TextBoxFor(m => m.SmtpHost, new { @maxlength = "100", @required = "required", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>SMTP Port</label>
                                @Html.TextBoxFor(m => m.SmtpPort, new { @maxlength = "100", @type="number", @required = "required", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>SMTP Username</label>
                                @Html.TextBoxFor(m => m.SmtpUserName, new { @maxlength = "100", @required = "required", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>SMTP Password</label>
                                @Html.TextBoxFor(m => m.SmtpPassword, new { @maxlength = "100", @required = "required", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                @Html.CheckBoxFor(m => m.EnableSsl)<label>Enable SSL</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>From Address</label>
                                @Html.TextBoxFor(m => m.FromAddress, new { @maxlength = "100", @type="email", @required = "required", @class = "form-control form-control-sm" })
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="btnEmailSetting" class="btn btn-info waves-effect waves-light float-right">Save</button>
                </form>
            </div>
        </div>
        <div class="tab-pane" id="password" role="tabpanel">
            <div class="card-body">
                <form id="formPassword">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>New PIN</label>
                                <input type="password" id="txtPassword" maxlength="4" class="form-control form-control-sm" required />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label>Confirm PIN</label>
                                <input type="password" id="txtConfirmPassword" maxlength="4" class="form-control form-control-sm" required />
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="btnSavePassword" class="btn btn-info waves-effect waves-light float-right">Save</button>
                </form>
            </div>
        </div>
    </div>
}

@section scripts {
    <script>
        $(document).ready(function () {
            $("#formCompanyInfo").submit(function () {
                $.ajax({
                    beforeSend: function () { $("#btnSaveCompanyInfo").html("Please wait.."); $("#btnSaveCompanyInfo").attr("disabled", "disabled"); },
                    complete: function () { $("#btnSaveCompanyInfo").html("Save"); $("#btnSaveCompanyInfo").removeAttr("disabled"); },
                    context: document.body,
                    data: { CompanyName: $("#CompanyName").val(), Gstin: $("#Gstin").val(), Pan: $("#Pan").val(), Mobile: $("#Mobile").val(), Landline: $("#Landline").val(), Email: $("#Email").val(), Website: $("#Website").val(), Address: $("#Address").val(), Pincode: $("#Pincode").val(), City: $("#City").val(), State: $("#State").val(), AccountNo: $("#AccountNo").val(), AccountName: $("#AccountName").val(), BankName: $("#BankName").val(), Ifsc: $("#Ifsc").val() },
                    error: function (e) { swal(e.Message, "", "error"); },
                    success: function (data) {
                        if (data.success === true)
                            swal("Saved!", "Company info updated successfully. Please reload the page.", "success");
                        else if (data.success === false)
                            swal("Cancelled", data.Message, "error");
                    },
                    dataType: "json",
                    type: "POST",
                    url: "/Home/SaveCompanyInfo"
                });

                return false;
            });

            $("#formBankAccountInfo").submit(function () {
                $.ajax({
                    beforeSend: function () { $("#btnSaveBankAccountInfo").html("Please wait.."); $("#btnSaveBankAccountInfo").attr("disabled", "disabled"); },
                    complete: function () { $("#btnSaveBankAccountInfo").html("Save"); $("#btnSaveBankAccountInfo").removeAttr("disabled"); },
                    context: document.body,
                    data: { AccountNo: $("#AccountNo").val(), AccountName: $("#AccountName").val(), AccountType: $("#AccountType").val(), BankName: $("#BankName").val(), Ifsc: $("#Ifsc").val(), Branch: $("#Branch").val() },
                    error: function (e) { swal(e.Message, "", "error"); },
                    success: function (data) {
                        if (data.success === true)
                            swal("Saved!", "Bank account info updated successfully", "success");
                        else if (data.success === false)
                            swal("Cancelled", data.Message, "error");
                    },
                    dataType: "json",
                    type: "POST",
                    url: "/Home/SaveBankAccountInfo"
                });

                return false;
            });

            $("#formEmailSetting").submit(function () {
                $.ajax({
                    beforeSend: function () { $("#btnEmailSetting").html("Please wait.."); $("#btnEmailSetting").attr("disabled", "disabled"); },
                    complete: function () { $("#btnEmailSetting").html("Save"); $("#btnEmailSetting").removeAttr("disabled"); },
                    context: document.body,
                    data: { SmtpHost: $("#SmtpHost").val(), SmtpPort: $("#SmtpPort").val(), SmtpUserName: $("#SmtpUserName").val(), SmtpPassword: $("#SmtpPassword").val(), EnableSsl: $("#EnableSsl").val(), FromAddress: $("#FromAddress").val() },
                    error: function (e) { swal(e.Message, "", "error"); },
                    success: function (data) {
                        if (data.success === true)
                            swal("Saved!", "Email Settings updated successfully", "success");
                        else if (data.success === false)
                            swal("Cancelled", data.Message, "error");
                    },
                    dataType: "json",
                    type: "POST",
                    url: "/Home/SaveEmailSetting"
                });

                return false;
            });

            $("#formPassword").submit(function () {
                if ($("#txtPassword").val() == $("#txtConfirmPassword").val()) {
                    $.ajax({
                        beforeSend: function () { $("#btnSavePassword").html("Please wait.."); $("#btnSavePassword").attr("disabled", "disabled"); },
                        complete: function () { $("#btnSavePassword").html("Save"); $("#btnSavePassword").removeAttr("disabled"); },
                        context: document.body,
                        data: { Password: $("#txtPassword").val() },
                        error: function (e) { swal(e.Message, "", "error"); },
                        success: function (data) {
                            if (data.success === true)
                                swal("Saved!", "Password updated successfully", "success");
                            else if (data.success === false)
                                swal("Cancelled", data.Message, "error");
                        },
                        dataType: "json",
                        type: "POST",
                        url: "/Home/SavePassword"
                    });
                }
                else
                    swal("Cancelled", "Password does not match", "error");

                return false;
            });
        });
    </script>
}